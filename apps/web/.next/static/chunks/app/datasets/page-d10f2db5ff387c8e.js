(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{35350:(e,t,a)=>{Promise.resolve().then(a.bind(a,97103))},97103:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var s=a(39046),r=a(82014),n=a(69183),i=a(45128),c=a(91196),l=a(67495),o=a(40646),d=a(53413),u=a(32640),h=a(59582);function p(e){let{onSuccess:t}=e,[a,r]=(0,o.useState)(null),[n,l]=(0,o.useState)(""),[d,p]=(0,o.useState)(!1),m=(0,i.Zj)(),g=(0,o.useCallback)(e=>{e.preventDefault(),p(!0)},[]),x=(0,o.useCallback)(e=>{e.preventDefault(),p(!1)},[]),f=(0,o.useCallback)(e=>{e.preventDefault(),p(!1);let t=e.dataTransfer.files[0];t&&t.name.endsWith(".csv")?(r(t),n||l(t.name.replace(".csv",""))):alert("Please upload a CSV file")},[n]),y=async e=>{if(e.preventDefault(),!a)return;let s=n||a.name.replace(".csv","");m.mutate({name:s,file:a},{onSuccess:()=>{r(null),l(""),null==t||t()}})};return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Upload CSV File"}),(0,s.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(h.J,{htmlFor:"datasetName",children:"Dataset Name"}),(0,s.jsx)(u.p,{id:"datasetName",type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"My Sales Data",className:"mt-1"})]}),(0,s.jsx)("div",{onDragOver:g,onDragLeave:x,onDrop:f,className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(d?"border-indigo-500 bg-indigo-50":"border-gray-300 hover:border-gray-400"),children:a?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("svg",{className:"mx-auto h-12 w-12 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:a.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[(a.size/1024).toFixed(2)," KB"]}),(0,s.jsx)("button",{type:"button",onClick:()=>r(null),className:"text-sm text-indigo-600 hover:text-indigo-500",children:"Remove"})]}):(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,s.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,s.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-medium text-indigo-600 hover:text-indigo-500",children:[(0,s.jsx)("span",{children:"Upload a file"}),(0,s.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",accept:".csv",className:"sr-only",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(r(a),n||l(a.name.replace(".csv","")))}})]}),(0,s.jsx)("span",{className:"pl-1",children:"or drag and drop"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"CSV files only"})]})}),m.isError&&(0,s.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,s.jsx)("p",{className:"text-sm text-red-800",children:m.error instanceof Error?m.error.message:"Upload failed. Please try again."})}),(0,s.jsx)(c.$,{type:"submit",className:"w-full",disabled:!a||m.isPending,children:m.isPending?"Uploading...":"Upload Dataset"})]})]})}function m(){let{data:e,isLoading:t,error:a}=(0,i.hS)(),r=(0,i.f7)();if(t)return(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsx)("p",{className:"text-gray-500",children:"Loading datasets..."})});if(a)return(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsx)("p",{className:"text-red-600",children:"Failed to load datasets"})});let n=Array.isArray(e)?e:[];if(0===n.length)return(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsx)("p",{className:"text-gray-500 text-center",children:"No datasets yet. Upload your first CSV file to get started!"})});let l=e=>{switch(e){case"READY":return"bg-green-100 text-green-800";case"PROCESSING":return"bg-yellow-100 text-yellow-800";case"FAILED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},o=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),u=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":(e/1048576).toFixed(2)+" MB";return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Your Datasets"})}),(0,s.jsx)("div",{className:"divide-y divide-gray-200",children:n.map(e=>(0,s.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 transition",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("h4",{className:"text-base font-medium text-gray-900",children:e.name}),(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(l(e.status)),children:e.status})]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center space-x-4 text-sm text-gray-500",children:[(0,s.jsx)("span",{children:e.fileName}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:u(e.fileSize)}),(0,s.jsx)("span",{children:"•"}),(0,s.jsxs)("span",{children:[e.rowCount.toLocaleString()," rows"]}),(0,s.jsx)("span",{children:"•"}),(0,s.jsxs)("span",{children:["Uploaded ",o(e.createdAt)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:["READY"===e.status&&(0,s.jsx)(d.default,{href:"/analytics/".concat(e.id),children:(0,s.jsx)(c.$,{variant:"default",size:"sm",children:"View Analytics"})}),(0,s.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>r.mutate(e.id),disabled:r.isPending,children:r.isPending?"Deleting...":"Delete"})]})]})},e.id))})]})}function g(){let{user:e,isAuthenticated:t}=(0,r.n)(),a=(0,n.Wn)(),u=(0,l.useRouter)(),[h,g]=(0,o.useState)(!1),{refetch:x}=(0,i.hS)();return((0,o.useEffect)(()=>{g(!0)},[]),(0,o.useEffect)(()=>{h&&!t&&u.push("/login")},[h,t,u]),h&&t&&e)?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("nav",{className:"bg-white shadow-sm",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,s.jsx)(d.default,{href:"/dashboard",children:(0,s.jsx)("h1",{className:"text-2xl font-bold text-indigo-600",children:"SalesScope"})}),(0,s.jsxs)("nav",{className:"flex space-x-4",children:[(0,s.jsx)(d.default,{href:"/dashboard",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"Dashboard"}),(0,s.jsx)(d.default,{href:"/datasets",className:"text-indigo-600 px-3 py-2 rounded-md text-sm font-medium bg-indigo-50",children:"Datasets"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["Welcome, ",e.name,"!"]}),(0,s.jsx)(c.$,{variant:"outline",onClick:()=>a.mutate(),disabled:a.isPending,children:a.isPending?"Logging out...":"Logout"})]})]})})}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Manage Your Datasets"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsx)(p,{onSuccess:()=>{x()}})}),(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsx)(m,{})})]})]})})]}):null}},91196:(e,t,a)=>{"use strict";a.d(t,{$:()=>r});var s=a(39046);let r=a(40646).forwardRef((e,t)=>{let{className:a="",variant:r="default",size:n="default",...i}=e;return(0,s.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"," ").concat({default:"bg-[#4F46E5] text-primary-foreground hover:bg-[#4F46E5]/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground"}[r]," ").concat({default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8"}[n]," ").concat(a),ref:t,...i})});r.displayName="Button"},32640:(e,t,a)=>{"use strict";a.d(t,{p:()=>r});var s=a(39046);let r=a(40646).forwardRef((e,t)=>{let{className:a="",type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ".concat(a),ref:t,...n})});r.displayName="Input"},59582:(e,t,a)=>{"use strict";a.d(t,{J:()=>r});var s=a(39046);let r=a(40646).forwardRef((e,t)=>{let{className:a="",...r}=e;return(0,s.jsx)("label",{ref:t,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ".concat(a),...r})});r.displayName="Label"},69183:(e,t,a)=>{"use strict";a.d(t,{LR:()=>c,Wn:()=>o,vz:()=>l});var s=a(41255),r=a(67495),n=a(14950),i=a(82014);function c(){let e=(0,r.useRouter)(),{setTokens:t,setUser:a}=(0,i.n)();return(0,s.n)({mutationFn:async e=>{let t=await n.u.register(e);if(!t.success||!t.data)throw Error("Registration failed");return t.data},onSuccess:async s=>{n.u.setAccessToken(s.accessToken),t(s.accessToken,"");let r=await n.u.getCurrentUser();r.success&&r.data&&(a(r.data),e.push("/dashboard"))}})}function l(){let e=(0,r.useRouter)(),{setTokens:t,setUser:a}=(0,i.n)();return(0,s.n)({mutationFn:async e=>{let t=await n.u.login(e);if(!t.success||!t.data)throw Error("Login failed");return t.data},onSuccess:async s=>{n.u.setAccessToken(s.accessToken),t(s.accessToken,"");let r=await n.u.getCurrentUser();r.success&&r.data&&(a(r.data),e.push("/dashboard"))}})}function o(){let e=(0,r.useRouter)(),t=(0,i.n)(e=>e.logout);return(0,s.n)({mutationFn:async()=>{await n.u.logout()},onSuccess:()=>{n.u.setAccessToken(null),t(),e.push("/login")}})}},45128:(e,t,a)=>{"use strict";a.d(t,{EL:()=>o,Zj:()=>c,f7:()=>d,hS:()=>l});var s=a(73582),r=a(41255),n=a(94009),i=a(14950);function c(){let e=(0,s.jE)();return(0,r.n)({mutationFn:async e=>{let t=new FormData;t.append("file",e.file),t.append("name",e.name);let a=await i.u.uploadDataset(t);if(!a.success)throw Error("Upload failed");return a.data},onSuccess:()=>{e.invalidateQueries({queryKey:["datasets"]})}})}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(0,n.I)({queryKey:["datasets",e,t],queryFn:async()=>{let a=await i.u.listDatasets(e,t);if(!a.success)throw Error("Failed to fetch datasets");return a.data}})}function o(e){return(0,n.I)({queryKey:["dataset",e],queryFn:async()=>{let t=await i.u.getDataset(e);if(!t.success)throw Error("Failed to fetch dataset");return t.data},enabled:!!e})}function d(){let e=(0,s.jE)();return(0,r.n)({mutationFn:async e=>{if(!(await i.u.deleteDataset(e)).success)throw Error("Delete failed")},onSuccess:()=>{e.invalidateQueries({queryKey:["datasets"]})}})}},14950:(e,t,a)=>{"use strict";a.d(t,{u:()=>r});class s{setAccessToken(e){this.accessToken=e}getAccessToken(){return this.accessToken}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(this.baseURL).concat(e),s={...t.headers};t.body&&(s["Content-Type"]="application/json"),this.accessToken&&(s.Authorization="Bearer ".concat(this.accessToken));let r={...t,headers:s,credentials:"include"},n=await fetch(a,r);if(!n.ok){var i;throw Error((null===(i=(await n.json().catch(()=>({error:{code:"UNKNOWN_ERROR",message:"An unknown error occurred"}}))).error)||void 0===i?void 0:i.message)||"Request failed")}return n.json()}async register(e){return this.request("/api/auth/register",{method:"POST",body:JSON.stringify(e)})}async login(e){return this.request("/api/auth/login",{method:"POST",body:JSON.stringify(e)})}async refresh(){return this.request("/api/auth/refresh",{method:"POST"})}async logout(){return this.request("/api/auth/logout",{method:"POST"})}async getCurrentUser(){return this.request("/api/auth/me")}async uploadDataset(e){let t="".concat(this.baseURL,"/api/datasets/upload"),a={};this.accessToken&&(a.Authorization="Bearer ".concat(this.accessToken));let s=await fetch(t,{method:"POST",headers:a,credentials:"include",body:e});if(!s.ok){var r;throw Error((null===(r=(await s.json().catch(()=>({error:{code:"UNKNOWN_ERROR",message:"An unknown error occurred"}}))).error)||void 0===r?void 0:r.message)||"Upload failed")}return s.json()}async listDatasets(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return this.request("/api/datasets?page=".concat(e,"&limit=").concat(t))}async getDataset(e){return this.request("/api/datasets/".concat(e))}async deleteDataset(e){return this.request("/api/datasets/".concat(e),{method:"DELETE"})}async getKPIs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new URLSearchParams;t.startDate&&a.append("startDate",t.startDate),t.endDate&&a.append("endDate",t.endDate),t.category&&a.append("category",t.category),t.product&&a.append("product",t.product);let s=a.toString();return this.request("/api/analytics/".concat(e,"/kpis").concat(s?"?".concat(s):""))}async getRevenueByDate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new URLSearchParams;t.startDate&&a.append("startDate",t.startDate),t.endDate&&a.append("endDate",t.endDate),t.category&&a.append("category",t.category),t.product&&a.append("product",t.product);let s=a.toString();return this.request("/api/analytics/".concat(e,"/revenue-by-date").concat(s?"?".concat(s):""))}async getRevenueByCategory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new URLSearchParams;t.startDate&&a.append("startDate",t.startDate),t.endDate&&a.append("endDate",t.endDate),t.category&&a.append("category",t.category),t.product&&a.append("product",t.product);let s=a.toString();return this.request("/api/analytics/".concat(e,"/revenue-by-category").concat(s?"?".concat(s):""))}async getRevenueByProduct(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new URLSearchParams;t.startDate&&a.append("startDate",t.startDate),t.endDate&&a.append("endDate",t.endDate),t.category&&a.append("category",t.category),t.product&&a.append("product",t.product);let s=a.toString();return this.request("/api/analytics/".concat(e,"/revenue-by-product").concat(s?"?".concat(s):""))}async getAvailableFilters(e){return this.request("/api/analytics/".concat(e,"/filters"))}async getOverview(){return this.request("/api/analytics/overview")}async getDatasetsSummary(){return this.request("/api/analytics/datasets-summary")}async getTrends(){return this.request("/api/analytics/trends")}constructor(e){this.accessToken=null,this.baseURL=e}}let r=new s("http://localhost:3002")},82014:(e,t,a)=>{"use strict";a.d(t,{n:()=>n});var s=a(23170),r=a(2006);let n=(0,s.v)()((0,r.Zr)(e=>({accessToken:null,refreshToken:null,user:null,isAuthenticated:!1,setTokens:(t,a)=>e({accessToken:t,refreshToken:a,isAuthenticated:!0}),setUser:t=>e({user:t}),logout:()=>e({accessToken:null,refreshToken:null,user:null,isAuthenticated:!1})}),{name:"auth-storage"}))}},e=>{var t=t=>e(e.s=t);e.O(0,[948,502,558,563,787,358],()=>t(35350)),_N_E=e.O()}]);